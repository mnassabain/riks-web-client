<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf8" />
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/css?family=Limelight" rel="stylesheet">
		 <link rel="stylesheet" href="style.css"/>
		<link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>
            <div id="container">
            </div>
            <button id="btn">increase</button>
  <script>

var button = document.getElementById("btn");

button.addEventListener("click", function(){


  /* change player's id here  id =  {0,1,2,3,4,5} */
  ratioBarPlayer("2","0", true);

});


/* this function creates a ratio bar of n players */
var createPlayerList = function(n)
{
    var isEmpty, widths;
    widths = JSON.parse(localStorage.getItem('widths'));

    if( widths == null)
    {
        widths = {};
        isEmpty = true ;

    }
    else
    {
        isEmpty = false;
    }

    var colors = ["red","yellow","green","blue","lightgreen","black"];
    var container  = document.getElementById("container");
    var width      = container.offsetWidth;
    var childWidth = width/n ;
    var id ;

    for(var j = 0 ; j < n ; j++)
    {
        var div = document.createElement("div");
        div.id   =  "" + j ;
        div.style.backgroundColor = colors[j];
        if(isEmpty)
        {
            div.style.width = childWidth + "px";
            widths["" +j] = childWidth ;
        }
        else
        {

            div.style.width = widths["" +j] + "px";
        }
        if(widths["" +j] != 0)
        {
            /* adding element in the DOM */
            container.appendChild(div);
        }
    }

    if(isEmpty)
    {
        localStorage.setItem('widths',JSON.stringify(widths));
    }

    console.log(widths);

}


/* this function update the value of  a width's div   */
var saveRatioBar = function(id1, id2)
{
    var width1 = document.getElementById(id1).offsetWidth;
    var width2 = document.getElementById(id2).offsetWidth;
    var widths = JSON.parse(localStorage.getItem('widths'));
    widths[id1] = width1;
    widths[id2] = width2;
    localStorage.setItem('widths',JSON.stringify(widths));
}




/* change the number of player here */
createPlayerList(6);


/* if win is  true that means player1 win  */
function ratioBarPlayer(id1, id2, win)
{
    var container = document.getElementById("container");
    var div1      = document.getElementById(id1);
    var div2      = document.getElementById(id2);
    var divs      = document.querySelectorAll("#container > div");
    var widths    = JSON.parse(localStorage.getItem('widths'));
    var length    = divs.length ;

    /* if player 1 wins */
    if(win)
    {
        if( div2.offsetWidth != 0 )
        {
            /*add 1 px to player 1 's div */
            div1.style.width = (div1.offsetWidth + 1) + 'px';
            /*remove 1 px to player 2 's div */
            div2.style.width = (div2.offsetWidth - 1) + 'px';
        }
    }
    else
    {
        if( div1.offsetWidth != 0)
        {
            div2.style.width = (div2.offsetWidth + 1) + 'px';
            div1.style.width = (div1.offsetWidth - 1) + 'px';
        }
    }

    /* save new div's widths value*/
    saveRatioBar(id1,id2);

    if(div1.offsetWidth == 0 )
    {
        /* removing div if the corresponding player is eliminate */
        container.removeChild(div1);
    }

    if(div2.offsetWidth == 0 )
    {
        /* removing div if the corresponding player is eliminate */
        container.removeChild(div2);
    }
}


function animation(id)
{
    var element = document.getElementById(id);

    element.animate([
    { opacity: '1' },
    { opacity: '0.75' },
    { opacity: '0.50' },
    { opacity: '0.25' }
    ],
    {
        duration: 1000,
        direction: 'alternate',
        iterations: Infinity
    });

}

function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
  ev.preventDefault();
  /* data is the id of the dragged element */
  var data = ev.dataTransfer.getData("text");
  /* adding the the dragged element to its new parent*/
  ev.target.appendChild(document.getElementById(data));
}
  </script>

</body>
</html>
